# This is a data set of 1676 images, processed by xx. Here are some notes: 

# Step01 - Import images 

Input files: Micrographs/*.tif

Node type: 2D micrographs movies (*.mrcs, *tiff)

# Step02 - Motion correction

## I/O

Input movies STAR file: Import/job001/movies.star

First frame for corrected sum: 1

Last frame for corrected sum: -1 

Pixel size (A): 1.06

Voltage (kV): 300

Dose per frame (e/A2): 1.5

Pre-exposure (e/A2): 0

Do dose-weighting? Yes

Save non-dose weighted as well? Yes



## Motion

Bfactor: 150

Number of patches X, Y: 7 7

Group frames: 1

Binning factor: 1

Gain rotation: No rotation (0)

Gain flip: No flipping (0)

Use RELION's own implementation? No

Which GPUs to use: 0:1:2:3

## Running

Number of MPI procs: 4

Number of threads: 8

Submit to queue? No



# Step03 - CTF estimation

## I/O

Input micrographs STAR file: MotionCorr/job002/corrected_micrographs.star

Use micrograph without dose-weighting? Yes

Spherical aberration (mm): 2.7

Voltage (kV): 300 

Amplitude contrast: 0.1

Magnified pixel size (Angstrom): 1.06

Amount of astigmastism (A): 500

## Searches

FFT box size (pix): 512

Minimum resolution (A): 30

Maximum resolution (A): 4

Minimum defocus value (A): 5000

Maximum defocus value (A): 30000

Defocus step size (A): 500

Estimate phase shifts? No


## CTFFIND-4.1

Use CTFFIND-4.1? Yes

CTFFIND-4.1 executable: /data/jianglab-nfs/programs/apps/ctffind-4.1.13/ctffind

Use exhaustive search? No

Estimate CTF on window size (pix): -1

## Running

Number of MPI procs: 12

Submit to queue? No


# Step04 - Particle Picking using GAutomatch ?

- [ ] cd to the MotionCor results folder generated by RELION (if you do MotionCor using RELION) -> cd to folder 2020... where you can find the *.mrc file

then,

[user@biowulf]$ sinteractive --gres=gpu:k80:1 --mem=20g -c14

[user@biowulf]$ module load gautomatch

[user@cn3144 ~]$ gautomatch --apixM 0.83 --diameter 160 *.mrc 

or,

## Using our own Linux GPU

module load Gautomatch/0.56

Gautomatch --apixM 0.83 --diameter 160 *.mrc

# Step05 - Subset selection, to discard unsatisfied micrographs ?

## Subsets

Select based on metadata values? Yes

Metadata label for subset selection: rlnCtfMaxResolution

Minimum metadata value: -9999.
Maximum metadata value: 4

## Running

Running without submitting to queue.

# Step06 - Import particle files generated by GAutomatch 

Input files: box_Gautomatch/box/*.box
Node type: 2D/3D particle coordinates (*.box, *_pick.star)

# Step07 - Subset selection 

Select ~200 images to make a subset, then extract particles from these images and do a quick Class2D. After quick Class2D, we can get templates that may used for template-based Autopick. In this way, we can get more accurate particle picking, and thus lower down the requirement for computational capability of following work, e.g. Class2D, Class 3D, which always cost several days for iterations and calcutations.   

# Step08 - Extract Particles

## I/O

micrograph STAR file: CtfFind/job003/micrographs_ctf_selected.star

Input coordinates: Import/job004/coords_suffix.box

## Extract

Particle box size (pix): 192

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): -1

Stddev for white dust removal: 5

Stddev for black dust removal: 5

Rescale particles? Yes

Rescaled size (pixels): 96

## Running

Number of MPI procs: 12



# Step09 - 2D classfiicaiton

## I/O

Input image STAR file: Extract/job005/particles.star

## CTF

Do CTF-correction? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? Yes

## Optimization

Number of classes: 50

Regularisation parameter T: 3

Number of iterations: 50

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 160  

Mask individual particles with zeros? Yes

Limit resolution E-step to (A): -1

## Sampling

Perform image alignment? Yes

In-plane angular sampling: 6

Offet search range (pix): 10

Offet search step (pix): 1

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy partilces to scratch directory: No

Combine iterations through disc? No

Use GPU acceleration? Yes

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 10

Number of threads: 3

Submit to queue? No

# Step10 - Subset selection

Select classes that interested, and save as templates.

![](https://github.com/asdstory/Single-particle-Reconstruction/blob/master/Figures/SubsetSelection-job007-20190429dataset.png)

# Step11 - 2D classfiicaiton

## I/O

Input image STAR file: Extract/job007/particles.star

## CTF

Do CTF-correction? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? Yes

## Optimization

Number of classes: 50

Regularisation parameter T: 3

Number of iterations: 50

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 170  

Mask individual particles with zeros? Yes

Limit resolution E-step to (A): -1

## Sampling

Perform image alignment? Yes

In-plane angular sampling: 6

Offet search range (pix): 10

Offet search step (pix): 1

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy partilces to scratch directory: No

Combine iterations through disc? No

Use GPU acceleration? Yes

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 10

Number of threads: 3

Submit to queue? No

# Step12 - Subset selection

## I/O 

Selec classes from model.star: Class2D/job008/run_it025_model.star


Select classes that interested, and save as templates.

![](https://github.com/asdstory/Single-Particle-Reconstruction/blob/master/Figures/SubsetSelection-job009-20190429dataset.png)


# Step13 - Import/job010

## I/O 

Input files: init3d/trimer_96.mrc

Node type: 3D reference (.mrc)

# Step14 - Import/job011

## I/O 

Input files: init3d/hexmer_96.mrc

Node type: 3D reference (.mrc)

# Step15 - Class3D/job014

## I/O

Input images STAR file: Select/job009/particles_1.star

Reference map: Import/job010/trimer_96.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 40

Symmetry: C3

## CTF

Do CTF-correction? Yes

Has reference been CTF-corrected? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Number of classes: 1

Regularisation parameter T: 4

Number of iterations: 30

Use fast subsets (for large datasets)? Yes

Mask diameter (A): 160

Mask individual particles with zeros? Yes

*If set to Yes, then in the individual particles, the area outside a circle with the radius of the particle will be set to zeros prior to taking the Fourier transform. This will remove noise and therefore increase sensitivity in the alignment and classification. However, it will also introduce correlations between the Fourier components that are not modelled. When set to No, then the solvent area is filled with random noise, which prevents introducing correlations.High-resolution refinements (e.g. ribosomes or other large complexes in 3D auto-refine) tend to work better when filling the solvent area with random noise (i.e. setting this option to No), refinements of smaller complexes and most classifications go better when using zeros (i.e. setting this option to Yes).*

Limit resolution E-step to (A): -1

*If set to a positive number, then the expectation step (i.e. the alignment) will be done only including the Fourier components up to this resolution (in Angstroms). This is useful to prevent overfitting, as the classification runs in RELION are not to be guaranteed to be 100% overfitting-free (unlike the 3D auto-refine with its gold-standard FSC). In particular for very difficult data sets, e.g. of very small or featureless particles, this has been shown to give much better class averages. In such cases, values in the range of 7-12 Angstroms have proven useful.*

## Sampling

Perfomr image alignment? Yes

Angular sampling interval: 3.7 degrees

Offset search range (pix): 10

Offset search step (pix): 1

Perform local angular searches? No

*If set to Yes, then rather than performing exhaustive angular searches, local searches within the range given below will be performed. A prior Gaussian distribution centered at the optimal orientation in the previous iteration and with a stddev of 1/3 of the range given below will be enforced.*

## Helix

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step16 - Class3D/job023

## I/O

Input images STAR file: Select/job009/particles_2.star

Reference map: Import/job010/trimer_96.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 40

Symmetry: C3

## CTF

Do CTF-correction? Yes

Has reference been CTF-corrected? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Number of classes: 1

Regularisation parameter T: 4

Number of iterations: 30

Use fast subsets (for large datasets)? Yes

Mask diameter (A): 160

Mask individual particles with zeros? Yes

*If set to Yes, then in the individual particles, the area outside a circle with the radius of the particle will be set to zeros prior to taking the Fourier transform. This will remove noise and therefore increase sensitivity in the alignment and classification. However, it will also introduce correlations between the Fourier components that are not modelled. When set to No, then the solvent area is filled with random noise, which prevents introducing correlations.High-resolution refinements (e.g. ribosomes or other large complexes in 3D auto-refine) tend to work better when filling the solvent area with random noise (i.e. setting this option to No), refinements of smaller complexes and most classifications go better when using zeros (i.e. setting this option to Yes).*

Limit resolution E-step to (A): -1

*If set to a positive number, then the expectation step (i.e. the alignment) will be done only including the Fourier components up to this resolution (in Angstroms). This is useful to prevent overfitting, as the classification runs in RELION are not to be guaranteed to be 100% overfitting-free (unlike the 3D auto-refine with its gold-standard FSC). In particular for very difficult data sets, e.g. of very small or featureless particles, this has been shown to give much better class averages. In such cases, values in the range of 7-12 Angstroms have proven useful.*

## Sampling

Perfomr image alignment? Yes

Angular sampling interval: 3.7 degrees

Offset search range (pix): 10

Offset search step (pix): 1

Perform local angular searches? No

*If set to Yes, then rather than performing exhaustive angular searches, local searches within the range given below will be performed. A prior Gaussian distribution centered at the optimal orientation in the previous iteration and with a stddev of 1/3 of the range given below will be enforced.*

## Helix

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step17 Import/box_trimer_job024/

## I/O

Input files: Class3D/job014/box/*.box

Node type: 2D/3D particle coordinates (*.box, *_pick.star)

# Step18 Import/box_trimer_job025/

## I/O

Input files: Class3D/job023/box/*.box

Node type: 2D/3D particle coordinates (*.box, *_pick.star)

# Step19 Particle extraction/trimer_job026/

## I/O

micrograph STAR file: CtfFind/job003/micrographs_ctf_selected.star

Input coordinates: Import/job024/coords_suffix.box

OR re-extract refined particles? No

Manually set pixel size? No

## extract

Particle box size (pix): 192

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): -1

Stddev for white dust removal: 5 

Stddev for black dust removal: 5

Rescale particles? No #This will help fast the 2D classification of large datasets, especially preliminary data from autopicking. 

## Helix

No

## Running 

Number of MPI procs: 12

Submit to queue? No


# Step20 Particle extraction/hexamer_job027/

## I/O

micrograph STAR file: CtfFind/job003/micrographs_ctf_selected.star

Input coordinates: Import/job025/coords_suffix.box

OR re-extract refined particles? No

Manually set pixel size? No

## extract

Particle box size (pix): 192

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): -1

Stddev for white dust removal: 5 

Stddev for black dust removal: 5

Rescale particles? No #This will help fast the 2D classification of large datasets, especially preliminary data from autopicking. 

## Helix

No

## Running 

Number of MPI procs: 12

Submit to queue? No

# Step21 - Import/job028

## I/O 

Input files: init3d/hexmer_192.mrc

Node type: 3D reference (.mrc)


# Step22 - Import/job029

## I/O 

Input files: init3d/mask_combo.mrc

Node type: 3D reference (.mrc)

# Step23 - Refine3D/hexamer_job030

## I/O

Input images STAR file: Extract/job027/particles.star

Reference map: Import/job028/hexmer_192.mrc

Reference mask (optional): Import/job029/mask_combo.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 20

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 160

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? Yes

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 5

Initial offset step (pix): 1

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step24 - 2D classfication/hexamer_job031

## I/O

Input image STAR file: Extract/job027/particles.star

## CTF

Do CTF-correction? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? Yes

## Optimization

Number of classes: 50

Regularisation parameter T: 3

Number of iterations: 30

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 160  

Mask individual particles with zeros? Yes

Limit resolution E-step to (A): -1

## Sampling

Perform image alignment? Yes

In-plane angular sampling: 6

Offet search range (pix): 5

Offet search step (pix): 1

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy partilces to scratch directory: No

Combine iterations through disc? No

Use GPU acceleration? Yes

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 10

Number of threads: 3

Submit to queue? No

# Step25 - Select/hexamer_job032

## I/O

Input images STAR file: Extract/job027/particles.star

# Step26 - Refine3D/hexamer_job033

## I/O

Input images STAR file: Select/job032/particles.star

Reference map: Refine3D/job030/run_class001.mrc

Reference mask (optional): Import/job029/mask_combo.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 20

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 160

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? Yes

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 5

Initial offset step (pix): 1

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step27 - Import/job034

## I/O 

Input files: Refine3D/job033/mask.mrc

Node type: 3D reference (.mrc) 

# Step28 Subtract/hexamer_job035

## I/O

Input particles: Refine3D/job033/run_data.star

Subtract partial signal? Yes

Map to be projected: Refine3D/job033/run_class001.mrc

Mask to apply to this map: Import/job034/mask.mrc

OR revert to original particles? No

## CTF

Do apply CTFs? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? No


# Step29 - Refine3D/hexamer_job036

## I/O

Input images STAR file: Subtract/job035/subtracted.star

Reference map: Refine3D/job030/run_class001.mrc

Reference mask (optional): Import/job029/mask_combo.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 20

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 160

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? Yes

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 5

Initial offset step (pix): 1

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: /scratch/nvme-ssd/

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step30 - Class2D/trimer_job037

## I/O

Input image STAR file: Extract/job026/particles.star

## CTF

Do CTF-correction? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? Yes

## Optimization

Number of classes: 50

Regularisation parameter T: 3

Number of iterations: 30

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 160  

Mask individual particles with zeros? Yes

Limit resolution E-step to (A): -1

## Sampling

Perform image alignment? Yes

In-plane angular sampling: 6

Offet search range (pix): 5

Offet search step (pix): 1

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy partilces to scratch directory: No

Combine iterations through disc? No

Use GPU acceleration? Yes

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 10

Number of threads: 3

Submit to queue? No


# Ste31 - Subtract/hexamer_job038

## I/O

Input particles: Refine3D/job036/run_data_orig.star

Subtract partial signal? Yes

Map to be projected: Refine3D/job036/run_class001.mrc

Mask to apply to this map: Import/job034/mask.mrc

OR revert to original particles? No

## CTF

Do apply CTFs? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? No

# Subset selection/trimer_job039/

## I/O

Select classes from model.star: Class2D/job037/run_it025_model.star

# Step32 - Import/job040

## I/O 

Input files: init3d/trimer_192.mrc

Node type: 3D reference (.mrc) 

# Step33 - Refine3D/hexamer_job041

## I/O

Input images STAR file: Select/job039/particles.star

Reference map: Refine3D/job030/run_class001.mrc

Reference mask (optional): Import/job040/trimer_192.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 20

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 160

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? No

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 5

Initial offset step (pix): 1

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: No
Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step34 - Post-processing/job042/

## I/O

One of the 2 unfiltered half-maps: Refine3D/job041/run_half1_class001_unfil.mrc

Solvent mask: Refine3D/job041/mask.mrc

Calibrated pixel size (A): 1.06

## Sharpen:

MTF of the detector (STAR): 

Estimate B-factor automatically? Yes

Lowest resolution for auto-B fit (A): 10

Use your own B-factor? No

## Filter

Skip FSC-weighting? No

Ad-hoc low-pass filter (A): 5

## Running

Submit to queue? No

# Step35 - Refine3D/trimer_job043

## I/O

Input images STAR file: Select/job039/particles.star

Reference map: Refine3D/job041/run_class001.mrc

Reference mask (optional): Refine3D/job041/mask.mrc

## Reference

Ref. map is on absolute greyscale? Yes

Initial low-pass filter (A): 20

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 150

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? Yes

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 5

Initial offset step (pix): 1

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No


# Step36 - Post-processing/job044/

## I/O

One of the 2 unfiltered half-maps: Refine3D/job043/run_half1_class001_unfil.mrc

Solvent mask: Refine3D/job041/mask.mrc

Calibrated pixel size (A): 1.06

## Sharpen:

MTF of the detector (STAR): 

Estimate B-factor automatically? Yes

Lowest resolution for auto-B fit (A): 10

Use your own B-factor? No

## Filter

Skip FSC-weighting? No

Ad-hoc low-pass filter (A): 5

## Running

Submit to queue? No

# Step37 JointStar/job046

## Particles

Combine paticles STAR files? Yes

Particle STAR file 1: Select/job039/particles.star

Particle STAR file 2: Subtract/job035/subtracted_1.star

Particle STAR file 3: Subtract/job038/subtracted_1.star

# Step38 - Refine3D/job048/

## I/O

Input images STAR file: JoinStar/job046/join_particles.star

Reference map: Refine3D/job041/run_class001.mrc

Reference mask (optional): Refine3D/job041/mask.mrc

## Reference

Ref. map is on absolute greyscale? Yes

Initial low-pass filter (A): 20

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 150

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? Yes

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 40

Initial offset step (pix): 4

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: /scratch/nvme-ssd/

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No


# Step39 - Post-processing/job049/

## I/O

One of the 2 unfiltered half-maps: Refine3D/job048/run_half1_class001_unfil.mrc

Solvent mask: Refine3D/job041/mask.mrc

Calibrated pixel size (A): 1.06

## Sharpen:

MTF of the detector (STAR): 

Estimate B-factor automatically? Yes

Lowest resolution for auto-B fit (A): 10

Use your own B-factor? No

## Filter

Skip FSC-weighting? No

Ad-hoc low-pass filter (A): 5

## Running

Submit to queue? No

# Step40 - Class3D/job050/

## I/O

Input images STAR file: Refine3D/job048/run_data.star

Reference map: Refine3D/job048/run_class001.mrc

Reference mask (optional): Refine3D/job041/mask.mrc

## Reference

Ref. map is on absolute greyscale? Yes

Initial low-pass filter (A): 10

Symmetry: C3

## CTF

Do CTF-correction? Yes

Has reference been CTF-corrected? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Number of classes: 4

Regularisation parameter T: 4

Number of iterations: 50

Use fast subsets (for large datasets)? Yes

Mask diameter (A): 150

Mask individual particles with zeros? Yes

*If set to Yes, then in the individual particles, the area outside a circle with the radius of the particle will be set to zeros prior to taking the Fourier transform. This will remove noise and therefore increase sensitivity in the alignment and classification. However, it will also introduce correlations between the Fourier components that are not modelled. When set to No, then the solvent area is filled with random noise, which prevents introducing correlations.High-resolution refinements (e.g. ribosomes or other large complexes in 3D auto-refine) tend to work better when filling the solvent area with random noise (i.e. setting this option to No), refinements of smaller complexes and most classifications go better when using zeros (i.e. setting this option to Yes).*

Limit resolution E-step to (A): -1

*If set to a positive number, then the expectation step (i.e. the alignment) will be done only including the Fourier components up to this resolution (in Angstroms). This is useful to prevent overfitting, as the classification runs in RELION are not to be guaranteed to be 100% overfitting-free (unlike the 3D auto-refine with its gold-standard FSC). In particular for very difficult data sets, e.g. of very small or featureless particles, this has been shown to give much better class averages. In such cases, values in the range of 7-12 Angstroms have proven useful.*

## Sampling

Perfomr image alignment? Yes

Angular sampling interval: 1.8 degrees

Offset search range (pix): 5

Offset search step (pix): 1

Perform local angular searches? Yes

*If set to Yes, then rather than performing exhaustive angular searches, local searches within the range given below will be performed. A prior Gaussian distribution centered at the optimal orientation in the previous iteration and with a stddev of 1/3 of the range given below will be enforced.*

Local angular search range: 5

## Helix

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Skip padding? No

Pre-read all particles into RAM? No

Copy particles to scratch directory: /scratch/nvme-ssd/

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step41 Subset selection/job051/

## Select classes from model.star: Class3D/job050/run_it038_model.star

# Step42 - Refine3D/job052/

## I/O

Input images STAR file: Select/job051/particles.star

Reference map: Refine3D/job041/run_class001.mrc

Reference mask (optional): Refine3D/job041/mask.mrc

## Reference

Ref. map is on absolute greyscale? Yes

Initial low-pass filter (A): 20

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 150

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? Yes

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 40

Initial offset step (pix): 4

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy particles to scratch directory: /scratch/nvme-ssd/

Combine iterations through disc? No

Use GPU accelerations? Yes 

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 3

Submit to queue? No

# Step43 - Post-processing/job053/

## I/O

One of the 2 unfiltered half-maps: Refine3D/job052/run_half1_class001_unfil.mrc

Solvent mask: Refine3D/job041/mask.mrc

Calibrated pixel size (A): 1.06

## Sharpen:

MTF of the detector (STAR): 

Estimate B-factor automatically? Yes

Lowest resolution for auto-B fit (A): 10

Use your own B-factor? No

## Filter

Skip FSC-weighting? No

Ad-hoc low-pass filter (A): 5

## Running

Submit to queue? No

# Step44 - Class2D/job054/

## I/O

Input image STAR file: Refine3D/job052/run_data.star

## CTF

Do CTF-correction? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? Yes

## Optimization

Number of classes: 50

Regularisation parameter T: 3

Number of iterations: 50

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 140  

Mask individual particles with zeros? Yes

Limit resolution E-step to (A): -1

## Sampling

Perform image alignment? No

In-plane angular sampling: 6

Offet search range (pix): 5

Offet search step (pix): 1

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy partilces to scratch directory: /scratch/nvme-ssd/

Combine iterations through disc? No

Use GPU acceleration? No

Which GPUs to use: 

## Running

Number of MPI procs: 12

Number of threads: 4

Submit to queue? No

# Step45 Subset selection

## I/O

Select classes from model.star: Class2D/job054/run_it031_model.star

# Step46 Particle extraction: 

## I/O

micrograph STAR file: CtfFind/job003/micrographs_ctf_selected.star

Input coordinates: 

OR re-extract refined particles? Yes

Refined particles STAR file: Select/job055/particles.star

Reset the refined offsets to zero? No

OR: re-center refined coordinates? Yes

Recenter on - X, Y, Z (pix): 0, 0, 0

Manually set pixel size? No

## Extract

Particle box size (pix): 160

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): -1

Stddev for white dust removal: 5

Stddev for black dust removal: 5

Rescale particles? No

Rescaled size (pixels): 

## Running

Number of MPI procs: 12

# Step47 - Class2D/job057/

## I/O

Input image STAR file: Extract/job056/particles.star

## CTF

Do CTF-correction? Yes

Have data been phase-flipped? No

Ignore CTFs until first peak? Yes

## Optimization

Number of classes: 50

Regularisation parameter T: 3

Number of iterations: 50

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 130  

Mask individual particles with zeros? Yes

Limit resolution E-step to (A): -1

## Sampling

Perform image alignment? Yes

In-plane angular sampling: 6

Offet search range (pix): 3

Offet search step (pix): 1

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 30

Pre-read all particles into RAM? No

Copy partilces to scratch directory: /scratch/nvme-ssd/

Combine iterations through disc? No

Use GPU acceleration? Yes

Which GPUs to use: 0:1:2

## Running

Number of MPI procs: 7

Number of threads: 4

Submit to queue? No

# Step48

# Step49

# Step50

# Step51

# Step52

# Step53

# Step54

# Step55

# Step56

# Step57

# Step58

# Step59

# Step60

# Step61

# Step62

# Step63

# Step64

# Step65

# Step66

# Step67

# Step68

# Step69

# Step70














# Step11 - Autopicking

Now, it's time to do template-based Auto-picking.

## I/O

Input micrographs for autopick: CtfFind/job005/micrographs_ctf.star

Pixel size in micrographs (A): -1

2D references: Select/job017/class_averages.star

## References

Pixel sieze in references (A): -1

## autopikcing

Picking thresold: 0.5

Minimum inter-particle distanc (A): 30

Maximum stddev noise: 1.1

Minimum avg noise: -0.5

Shrink factor: 0.5

## Running

Submit to queue? Yes

Queue name: gpu

# Step12 Partcle extraction

## I/O

micrograph STAR file: CtfFind/job005/micrographs_ctf_new.star

Input coordinates: Import/job021/coords_suffix_automatch.star

OR re-extract refined particles? No

Manually set pixel size? No

## extract

Particle box size (pix): 320

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): -1

Stddev for white dust removal: -1 

Stddev for black dust removal: -1

Rescale particles? Yes #This will help fast the 2D classification of large datasets, especially preliminary data from autopicking. 

Re-scale size (pixels): 80

## Helix

No

## Running 

Number of MPI procs: 16

Submit to queue? No

# Step13 - 2D classification  /job023

## I/O

Imput images STAR file: Extract/job022/particles.star

## CTF

Do CTF-correction? Yes

Have data been phase flipped? No

Ignore CTFs until first peak? Yes

## Optimization

Number of classes: 100

Regularisation parameter T: 2

Number of iterations: 25

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 200  #Since the PnuC trimer particle size is only ~80A, we may use 90A for the mask diameter here? 

## Sampling

Perform image alignment? Yes

In-plane angular sampling? 6

Offset search range (pix): 5

Offset search step (pix): 1

## Helix

Classify 2D helical segments? No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 3

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

## Running

Number of MPI procs: 18

Number of threads: 1

Submit to queue? Yes

Queue name: gpu

Queue submit command: sbatch

Walltime: 3-00:00:00

Memory Per Thread: 8g

Gres: lscratch:200, gpu:v100x:4

Addl (ex4) SBATCH Directives: -N 6 --ntasks-per-node=3

Standard submission script: /usr/local/apps/RELION/templates/common.sh

Minimum dedicated cores per node: 1

# Step14 Select /job026

Select classes from model.star: Class2D/job023/run_it025_model.star

# Step15 3D classification /job037

This class3D aimed at centering all the particles and further aid following 2D classifications. 

## I/O

Input images STAR file: Select/job026/particles.star

Reference map: ../PnuC_3NR_ModelBuilding/cryosparc_80Pix0.83A.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 50

Symmetry: C3

## CTF

Do CTF-correction? Yes

Has reference been CTF-corrected? Yes

## Optimisation

Number of classes: 1

Regularisation parameter T: 4

Number of iterations: 20

Use fast subsets (for large datasets)? Yes

Mask diameter (A): 200

Mask individual particles with zeros? Yes

*If set to Yes, then in the individual particles, the area outside a circle with the radius of the particle will be set to zeros prior to taking the Fourier transform. This will remove noise and therefore increase sensitivity in the alignment and classification. However, it will also introduce correlations between the Fourier components that are not modelled. When set to No, then the solvent area is filled with random noise, which prevents introducing correlations.High-resolution refinements (e.g. ribosomes or other large complexes in 3D auto-refine) tend to work better when filling the solvent area with random noise (i.e. setting this option to No), refinements of smaller complexes and most classifications go better when using zeros (i.e. setting this option to Yes).*

Limit resolution E-step to (A): -1

*If set to a positive number, then the expectation step (i.e. the alignment) will be done only including the Fourier components up to this resolution (in Angstroms). This is useful to prevent overfitting, as the classification runs in RELION are not to be guaranteed to be 100% overfitting-free (unlike the 3D auto-refine with its gold-standard FSC). In particular for very difficult data sets, e.g. of very small or featureless particles, this has been shown to give much better class averages. In such cases, values in the range of 7-12 Angstroms have proven useful.*

## Sampling

Perfomr image alignment? Yes

Angular sampling interval: 7.5 degrees

Offset search range (pix): 5

Offset search step (pix): 1

Perform local angular searches? No

*If set to Yes, then rather than performing exhaustive angular searches, local searches within the range given below will be performed. A prior Gaussian distribution centered at the optimal orientation in the previous iteration and with a stddev of 1/3 of the range given below will be enforced.*

## Helix

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 3

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

## Running

Number of MPI procs: 15

Number of threads: 1

Submit to queue? Yes

Queue name: gpu

Queue submit command: sbatch

Walltime: 1-00:00:00

Memory Per Thread: 8g

Gres: lscratch:200, gpu:v100x:4

Addl (ex4) SBATCH Directives: -N 5 --ntasks-per-node=3

Standard submission script: /usr/local/apps/RELION/templates/common.sh

Minimum dedicated cores per node: 1

# Step16 Subset selection

Select classes from model.star: Class3D/job037/run_it020_model.star

# Step17 Particle extraction

## I/O

micrograph STAR file: CtfFind/job005/micrographs_ctf_new.star

Input coordinates: 

OR re-extract refined particles? Yes

Refined particles STAR file: Select/job039/particles.star

Reset the refined offsets to zero? No

Re-center refined coordinates? yes

Recenter on -X, Y, Z (pix): 0 0 0 

Manually set pixel size? No

## extract

Particle box size (pix): 320

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): -1

Stddev for white dust removal: -1 

Stddev for black dust removal: -1

Rescale particles? Yes #This will help fast the 2D classification of large datasets, especially preliminary data from autopicking. 

Re-scale size (pixels): 80

## Helix

No

## Running 

Number of MPI procs: 16

Submit to queue? No

# Step18 - 2D classification  /job041

## I/O

Imput images STAR file: Extract/job044/particles.star

## CTF

Do CTF-correction? Yes

Have data been phase flipped? No

Ignore CTFs until first peak? No

## Optimization

Number of classes: 100

Regularisation parameter T: 2

Number of iterations: 25

Use fast subsets (for large data sets)? Yes

Mask diameter (A): 200  #Since the PnuC trimer particle size is only ~80A, we may use 90A for the mask diameter here? 

Mask individual particles with zeros? Yes

Limit resolution E-step to (A): -1 

## Sampling

Perform image alignment? Yes

In-plane angular sampling? 6

Offset search range (pix): 5

Offset search step (pix): 1

## Helix

Classify 2D helical segments? No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 3

Pre-read all particles into RAM? No

Copy particles to scratch directory: No

Combine iterations through disc? No

Use GPU accelerations? Yes 

## Running

Number of MPI procs: 15

Number of threads: 1

Submit to queue? Yes

Queue name: gpu

Queue submit command: sbatch

Walltime: 3-00:00:00

Memory Per Thread: 8g

Gres: lscratch:200, gpu:v100x:4

Addl (ex4) SBATCH Directives: -N 5 --ntasks-per-node=3

Standard submission script: /usr/local/apps/RELION/templates/common.sh

Minimum dedicated cores per node: 1

# Step19 Subset selection /job042

Select classes from model.star: Class2D/job041/run_it025_model.star



# Step21 Subset selection /job044

Select classes from model.star: Class2D/job043/run_it025_model.star

# Step22 Particle extraction /job058

## I/O

micrograph STAR file: CtfFind/job005/micrographs_ctf_new.star

Input coordinates: 

OR re-extract refined particles? Yes

Refined particles STAR file: Select/job044/particles.star

Reset the refined offsets to zero? No

Re-center refined coordinates? yes

Recenter on -X, Y, Z (pix): 0 0 0 

Manually set pixel size? No

## extract

Particle box size (pix): 320

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): -1

Stddev for white dust removal: -1 

Stddev for black dust removal: -1

Rescale particles? No

Re-scale size (pixels): 

## Helix

No

## Running 

Number of MPI procs: 16

Submit to queue? No


# Step23 - Refine3D /Job059

## I/O

Input images STAR file: Extract/job058/particles.star

Reference map: Class3D/job046/run_ct150_it200_class001.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 50

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 200

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? No

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 5

Initial offset step (pix): 1

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 3

Pre-read all particles into RAM? No

Copy particles to scratch directory: /lscratch/$SLURM_JOB_ID

Combine iterations through disc? No

Use GPU accelerations? Yes 

## Running

Number of MPI procs: 15

Number of threads: 1

Submit to queue? Yes

Queue name: gpu

Queue submit command: sbatch

Walltime: 1-00:00:00

Memory Per Thread: 8g

Gres: lscratch:200, gpu:v100x:4

Addl (ex4) SBATCH Directives: -N 5 --ntasks-per-node=3

Standard submission script: /usr/local/apps/RELION/templates/common.sh

Minimum dedicated cores per node: 1


# Step24 - MaskCreate /Job060

## I/O

Input 3D map: Refine3D/job059/run_class001.mrc

## Mask

Lowpass filter map (A): 15

Initial binarisation threshold: 0.01 #Usually we start this parameter with 0.01, and then optimize around 0.01 by step of 0.002 to get best resolution. 

Extend binary map this many pixels: 5

Add a soft-edge of this many pixels: 15

## Running

using CPUs.

Number of threads: 16


# Step25 - PostProcess /Job061

## I/O

One of the 2 unfiltered half-map: Refine3D/job059/run_half1_class001_unfil.mrc

Solvent mask: MaskCreate/job060/mask.mrc

Calibrated pixel size (A): 0.83

## Sharpen

Estimate B-factor automatically? Yes

Lowest resolution for auto-B fit (A): 10

Use your own B-factor? No

Skip FSC-weighting? No

## Running

Submit to queue? No



# Step26 - CTF refinement

## I/O

Partcles (from Refine3D): Refine3D/job059/run_data.star

Postprocess STAR: PostProcess/job061/postprocess.star

## Fit

Minimum resolution for fits (A): 30

Perform CTF parameter fitting? Yes

Fit per-particle defocus? Yes

Range for defocus fit (A): 2000

Fit per-micrograh astigmatism? No

*If set to Yes, ctf_refine will try to refine astigamtism on a per-micrograph basis. This will require many particles and good signal-to-noise ratios per micrograph.*

Fit per-particle astigmatism? No

*If set to Yes, astigmatism will be estimated on a per-particle basis. This requires very strong data, i.e. very large particles with excellent signal-to-noise ratios.*

Fit per-micrograh phase-shift? No

*If set to Yes, ctf_refine will try to refine a phase-shift (amplitude contrast) on a per-micrograph basis. This may be useful for Volta-phase plate data, but will require many particles and good signal-to-noise ratios per micrograph.*

## Running

Number of MPI procs: 65

Number of threads: 2

Submit to queue? Yes

Queue name: multinode

Queue submit command: sbatch

Walltime: 1-00:00:00

Memory Per Thread: 8g

Gres: lscratch:200

Addl (ex4) SBATCH Directives: 

Standard submission script: /usr/local/apps/RELION/templates/common.sh

Minimum dedicated cores per node: 1


# Step27 - Bayesian Polishing - Running in training mode

## I/O

Micrographs (from MotionCorr): MotionCorr/job004/corrected_micrographs.star

Particles (from Refine3D or CtfRefine): CtfRefine/job062/particles_ctf_refine.star

Postprocess STAR file: PostProcess/job061/postprocess.star

First movie frame: 1

Last movie frame: -1

## Train

Train optimal parameters? Yes

Fraction of Fourier pixels for testing: 0.5

Use this many particles: 5000

## Polish

Perform particle polishing? No

## Running 

Number of MPI procs: 1 #Here training mode, you can only use 1 MPI, but may use multi threads to speed up

Number of threads: 16

Submit to queue? No



# Step28 - Bayesian Polishing - Running in polishing mode


## I/O

Micrographs (from MotionCorr): MotionCorr/job004/corrected_micrographs.star

Particles (from Refine3D or CtfRefine): CtfRefine/job062/particles_ctf_refine.star

Postprocess STAR file: PostProcess/job061/postprocess.star

First movie frame: 1

Last movie frame: -1

## Train

Train optimal parameters? No

## Polish

Perform particle polishing? Yes

Optimised parameter file: Polish/job064/opt_params.txt

OR use your own parameters? No

Minimum resolution for B-factor fit (A): 20

Maximum resolution for B-factor fit (A): -1

## Running 

Number of MPI procs: 1

Number of threads: 16

Submit to queue? Yes

Queue name: norm

Queue submit command: sbatch

Walltime: 1-00:00:00

Memory Per Thread: 8g

Gres: lscratch:200



# Step29 - Refine3D /Job067

## I/O

Input images STAR file: Polish/job066/shiny.star

Reference map: Class3D/job046/run_ct150_it200_class001.mrc

Reference mask (optional): 

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 50

Symmetry: C3

## CTF

Do CTF-correction? Yes

Ignore CTFs until first peak? Yes

Have data been phase-flipped? No

Ignore CTFs unitl first peak? No

## Optimisation

Mask diameter (A): 200

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? Yes

## Auto-sampling

Initial angular sampling: 7.5 degrees

Initial offset range (pix): 5

Initial offset step (pix): 1

Searches from auto-sampling: 1.8 degrees

*In the automated procedure to increase the angular samplings, local angular searches of -6/+6 times the sampling rate will be used from this angular sampling rate onwards. For most lower-symmetric particles a value of 1.8 degrees will be sufficient. Perhaps icosahedral symmetries may benefit from a smaller value such as 0.9 degrees.*

## Helix 

No

## Compute

Use parallel disc I/O? Yes

Number of pooled particles: 3

Pre-read all particles into RAM? No

Copy particles to scratch directory: /lscratch/$SLURM_JOB_ID

Combine iterations through disc? No

Use GPU accelerations? Yes 

## Running

Number of MPI procs: 15

Number of threads: 1

Submit to queue? Yes

Queue name: gpu

Queue submit command: sbatch

Walltime: 1-00:00:00

Memory Per Thread: 8g

Gres: lscratch:200, gpu:v100x:4

Addl (ex4) SBATCH Directives: -N 5 --ntasks-per-node=3

Standard submission script: /usr/local/apps/RELION/templates/common.sh

Minimum dedicated cores per node: 1


# Step30 - MaskCreate /Job071

## I/O

Input 3D map: Refine3D/job067/run_class001.mrc

## Mask

Lowpass filter map (A): 15

Initial binarisation threshold: 0.01 #Usually we start this parameter with 0.01, and then optimize around 0.01 by step of 0.002 to get best resolution. 

Extend binary map this many pixels: 5

Add a soft-edge of this many pixels: 15

## Running

using CPUs.

Number of threads: 16


# Step25 - PostProcess /Job061

## I/O

One of the 2 unfiltered half-map: Refine3D/job067/run_half1_class001_unfil.mrc

Solvent mask: MaskCreate/job071/mask.mrc

Calibrated pixel size (A): 0.83

## Sharpen

Estimate B-factor automatically? Yes

Lowest resolution for auto-B fit (A): 10

Use your own B-factor? No

Skip FSC-weighting? No

## Running

Submit to queue? No

# Step26 Copy polished particle data into Cryosparc workstation

copy the "/data/dout2/20200304Krios_PnuC_3NR_Nanodisc/Polish/job066" folder into "/data/data2/dout2/P2".

# Step27 Cryosparc - Import Particle Stack /J24

Particle meta path: /data/data2/dout2/P2/job066/shiny.star

Particle data path: /data/data2/dout2/P2/job066/finished

# Step28 Cryosparc - Ab-Initia Reconstruction /J33

## Input

particles: J24.Imported_particles

## Particle preprocessing

Window dataset (real-space)

Window Inner radius: 0.85

Window outer radius: 0.99

## Ab0-Initio reconstruction

Number of Ab-Initio classes: 2

Maximum resolution (Angstroms): 12

Initial resolution (Angstroms): 35

Number of initial iterations: 200

Number of final iterations: 300

Fourier radius step: 0.04

# Step29 Cryosparc - Heterogeneous Refinement /J36

## Inputs

particles: J33.particles_all_classes

volume: J33.volume_class_0
        J33.volume_class_1
        
## Heterogeneous Refinement

Refinement box size (Voxels): 128

Symmetry: C3

Plotting bfactor: -100

Batch size per class: 1000

# Step29 Cryosparc - Homogeneous Refinement (NEW!!) 

## Input 

particles: J36.particles_class_0

volume: J36.volume_class_0

mask: No input groups

## Homogeneous Refinement

Refinement box size (voxels): NONE

Symmetry: C3

Initial lowpass resolution (A): 30

GSFSC split resolution (A): 20


# Step30 Cryosparc - Non-uniform Refinement (BETA)

## Input

particles: J37.particles

volume: J37.volume

mask: J37.mask

## Non-uniform Refinement

Refinement box size (voxels): NONE

Symmetry: C3

Initial lowpass resolution (A): 30

GSFSC split resolution (A): 20

# Step31 repeat Ab0-Initio Reconstruction (2 class) -> Heterogeneous refinment -> Non-uniform refinement until resolution can't be further improved. 


# Step32 Cryosparc - Non-uniform Refinement (BETA)

## Input

particles: J74.particles

volume: J74.volume

mask: J74.mask

## Non-uniform Refinement

Refinement box size (voxels): NONE

Symmetry: C3

Initial lowpass resolution (A): 30

GSFSC split resolution (A): 20

# Step33 Cryosparc - Local Refinement (BETA)

## Inputs:

particles: J75.particles

volume: J75.volume

mask: J75.mask

# Step34 Cryosparc - Local Resolution Estimation

## Inputs

Volume: J82.volume

mask: J82.mask

## Local resolution

Step size: 1

FSC threshold: 0.5

Adaptive Window Factor: 6

# Step35 Cryosparc - Local Filtering

*This should get the final map for model building? *

## Inputs:

Volume: J87.volume

## Local filtering

Filter type to apply: lanczos

Use GPU OR CPU for computation: GPU

# Step36 Sharpening Tools

## Inputs

volume : J88.volume

## Sharpening:

B-Factor to apply: 0

Use full FSC: Yes

Lowpass filter order: 8

Lowpass filter offset: 0 

Generate new FSC mask: No

Threshold: 0.5

Mask near (A): 6

Mask far (A): 12






















