# Example - Processing PnuC_0NR_20191206TF20.md, totally 278 images

# Step01 - Import images (motion corrected by MotionCorr2)

Input files: 2019-12-06-TYD-PnuC_0NR-C8-corrected-averagaes/*_sum_DW.mrc

Node type: 2D micrographs/tomograms(*.mrc)

# Step02 - CTF estimation

#I/O

Spherical aberration (mm): 1.2 #this dataset was collected on TF20, Building 8, under low mag (29kx)

Voltage (kV): 200

Amplitude contrast: 0.1

Magnified pixel size (Angstrom): 1.26

Amount of astigmastism (A): 100

#Searches

Use as default

#CTFFIND-4.1

Use CTFFIND-4.1? Yes

# Step03 - Particle Picking using GAutomatch

[user@biowulf]$ sinteractive --gres=gpu:k20x:1 --mem=20g 

[user@biowulf]$ module load gautomatch

[user@cn3144 ~]$ gautomatch --apixM 1.26 --diameter 70 *_sum_DW.mrc 

#Using our own Linux GPU

module load Gautomatch/0.56

#Seems that we can use 2*Particlediameter as the Autopick diameter in Gautomatch

Gautomatch --apixM 1.26 --diameter 160 *_sum_DW.mrc 



# Step04 - Import particle files generated by GAutomatch

Input files: 2019-11-28-TYD-PnuC_3NR_10mMEDTA-corrected-averages/*_automatch.star

Node type: 2D/3D particle coordinates (*.box, *_pick.star)

#You can view the auto-picking results directly after import particles, by display "coords_suffix_automatch.star".
#However, to view the particles, you have to set Manual picking parameters first:


#Optimization

Change diameters for GAutomach autopicking, and check on raw images if particles we want are picked.
For this case, try 70, 80, 90, 100. 

# Step05 - Extract Particles

#Extract

Particle box size (pix): 200

Diameter background circle (pix): 180

# Step06 - 2D classfiicaiton

# CTF

Do CTF-correction? Yes
Ignore CTFs until first peak? Yes

# Optimization

Number of classes: 50

Mask diameter (A): 160

#2D classification results showed good alignment.

# Step07 - Select 2D model interested

# Step08 - Make an initio model



# Step09 - Class3D /Job163

## I/O

Input images STAR file: Select/job156/particles.star

Reference map: 4QTN/4QTN15_box64.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 50

Symmetry: C3

## CTF

Do CTF-correction? Yes

Has reference been CTF-corrected? Yes

# Optimisation

Number of classes: 4

Regularisation parameter T: 4

Number of iterations: 50

Mask diameter (A): 150


# Step10 - Extract Particles /Job166

## I/O

micrograph STAR file: CtfFind/job489/micrographs_ctf.star

OR re-extract refined particles? Yes

Refined particles STAR file: Select/job165/particles.star

OR: re-center refined coordinates? Yes

Recenter on - X,Y,Z (pix): 0 0 0 

## Extract

Particle box size (pix): 200

Invert contrast? Yes

Normalize particles? Yes

Diameter background circle (pix): 180

Rescale particles? No


# Step16 - Refine3D /Job167

## I/O

Input images STAR file: Extract/job166/particles.star

Reference map: Class3D/job163/run_ct25_it050_class001_box256.mrc

## Reference

Ref. map is on absolute greyscale? No

Initial low-pass filter (A): 50

Symmetry: C3

## CTF

Do CTF-correction? Yes

## Optimisation

Mask diameter (A): 160

Mask individual particles with zeros? Yes

Use solvent-flattened FSCs? No

## Compute

Use GPUs


# Step17 - MaskCreate /Job180

## I/O

Input 3D map: Refine3D/job167/run_ct15_class001.mrc

## Mask

Lowpass filter map (A): 15

Initial binarisation threshold: 0.02

Extend binary map this many pixels: 20

Add a soft-edge of this many pixels: 20

## Running

using CPUs.

# Step18 - PostProcess /Job181

## I/O

One of the 2 unfiltered half-map: Refine3D/job167/run_ct15_half1_class001_unfil.mrc

Solvent mask: MaskCreate/job180/mask.mrc

Calibrated pixel size (A): 1.26

## Sharpen

Estimate B-factor automatically? Yes

## Running

Using CPUs.





## Further optimization - 1 Optimize the box size and Mask diameter
#I changed the Mask diameter to 170, redo the Particle extraction and 2D classification, see if this will make 2D alignment results much better.

#Try 1: 
Particle box size (pix): 200
Mask diameter (A): 170

#Results: 
1. Particles aligned much better than before, best class has 6% distribution.

#Try 2: 
Particle box size (pix): 170
Mask diameter (A): 150


## Further optimization - 2 Redo particle picking by optimizing GAutomatch parameters


[user@biowulf]$ sinteractive --gres=gpu:k20x:1 --mem=20g 

[user@biowulf]$ module load gautomatch

[user@cn3144 ~]$ gautomatch --apixM 1.26 --diameter 70 *_sum_DW.mrc 

#Here I lowered the diameter because I want to pick more particles, as more as possible.

After this, redo particle extraction, 2D classification and 3D classification, see if the 3D structure we get could be better.  






